<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IPv6ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã®ãƒ›ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸åˆ°é”ã•ã›ã‚‹æ–¹æ³•</title>
  <style>
    body { font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, Arial, sans-serif; background:#ffffff; color:#111; line-height:1.75; margin:0; }
    main { max-width: 960px; margin: 24px auto; padding: 24px; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); background:#fff; }
    h1 { color:#0b4a6f; margin:0 0 12px; }
    h2 { color:#0b4a6f; margin:24px 0 8px; }
    h3 { color:#0b4a6f; margin:16px 0 6px; }
    p { margin: 0 0 12px; }
    pre { background:#ffffff; color:#111; border:1px solid #cbd5e1; border-radius:8px; padding:12px; overflow:auto; }
    pre code { background:none; font-family: Consolas, Menlo, Monaco, "Courier New", monospace; font-size:15px; line-height:1.35; white-space:pre; display:block; }
    table { width:100%; border-collapse:collapse; margin: 12px 0; font-size: 14px; }
    th, td { border:1px solid #e5e7eb; padding:8px; text-align:left; }
    th { background:#f1f5f9; }
    ul { margin: 0 0 12px 20px; }
    .note { background:#e0f2fe; border-left:6px solid #0ea5e9; padding:12px; border-radius:6px; margin:12px 0; }
    .merit { background:#dcfce7; border-left:6px solid #22c55e; padding:12px; border-radius:6px; margin:12px 0; }
    .demerit { background:#fee2e2; border-left:6px solid #ef4444; padding:12px; border-radius:6px; margin:12px 0; }
    .summary { background:#f8fafc; border: 2px solid #e2e8f0; padding: 12px; border-radius: 8px; }
    .tag { display:inline-block; font-size:12px; padding:2px 8px; border-radius:9999px; background:#f1f5f9; color:#334155; border:1px solid #e2e8f0; margin-right:6px; }
  </style>
</head>
<body>
<main>
  <h1>ğŸ”Œ IPv6ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã®ãƒ›ã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸å‡ºã™ã«ã¯</h1>
  <p><span class="tag">IPv6</span><span class="tag">Link-Local</span><span class="tag">NAT64/DNS64</span><span class="tag">Proxy</span></p>
  <p><strong>çµè«–:</strong> <em>IPv6ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆfe80::/10ï¼‰ã ã‘</em>ã‚’æŒã¤ãƒ›ã‚¹ãƒˆã®ãƒ‘ã‚±ãƒƒãƒˆã¯ãƒ«ãƒ¼ã‚¿ã‚’è¶Šãˆã¦ã¯ã„ã‘ãªã„ãŸã‚ã€<strong>IPãƒ¬ã‚¤ãƒ¤ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«åˆ°é”ã§ãã¾ã›ã‚“</strong>ã€‚å®Ÿç¾ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã‚’ç”¨ã„ã¾ã™ã€‚</p>

  <div class="summary">
    <ol>
      <li><strong>ULA + DNS64/NAT64ï¼ˆæ¨å¥¨ï¼‰</strong> â€” ãƒ›ã‚¹ãƒˆã¯ <code>fd00::/8</code> ãªã©ã® ULA ã®ã¿ã‚’æŒã¡ã€ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒ v6â†’v4 å¤‰æ›ã—ã¦å¤–ã® IPv4 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸æ¥ç¶šã€‚</li>
      <li><strong>ã‚¢ãƒ—ãƒªå±¤ãƒ—ãƒ­ã‚­ã‚·</strong> â€” åŒä¸€ãƒªãƒ³ã‚¯ä¸Šã« HTTP/HTTPS ãƒ—ãƒ­ã‚­ã‚·ã‚„ SOCKS5 ã‚’ç«‹ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ IPv6ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ—ãƒ­ã‚­ã‚·ã¸æ¥ç¶šã€‚ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§å¤–ã«å‡ºã‚‹ã€‚</li>
    </ol>
  </div>

  <h2>ğŸ—ºï¸ æƒ³å®šãƒˆãƒãƒ­ã‚¸</h2>
  <pre><code> [HOSTA/B] ---[L2]--- [INSIDE GW] --- (outside: IPv4-only) --- Internet
    |  IPv6: fe80::/64  (ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿)      ^
    |                                              |
    +-- åŒä¸€ãƒªãƒ³ã‚¯ä¸Šã§åˆ°é”ã§ãã‚‹ã®ã¯INSIDE GWã¾ã§ --+</code></pre>

  <div class="note">ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã¯åŒä¸€ãƒªãƒ³ã‚¯å†…é™å®šã€‚<strong>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã® next-hop ã‚’ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã«æŒ‡å®šã™ã‚‹ã“ã¨è‡ªä½“ã¯å¯</strong>ã§ã™ãŒã€<em>é€ä¿¡å…ƒãŒãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¾ã¾</em>ã§ã¯ãƒ«ãƒ¼ã‚¿è»¢é€ä¸å¯ã§ã™ã€‚</div>

  <h2>âœ… æ–¹æ³•1ï¼šULA + DNS64/NAT64ï¼ˆæ¨å¥¨ï¼‰</h2>
  <p>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ ULA ã®ã¿ã€‚ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¯ inside ã§ IPv6/IPv4 ãƒ‡ãƒ¥ã‚¢ãƒ«ã€outside ã¯ IPv4 ã®ã¿ã§æ§‹ã„ã¾ã›ã‚“ã€‚</p>

  <h3>æ§‹æˆã‚¤ãƒ¡ãƒ¼ã‚¸</h3>
  <pre><code>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Inside (dual)                               Outside (IPv4-only) â”‚
     â”‚                                                                â”‚
     â”‚  [HOSTA/B]  ULA: fd00:1::/64                                   â”‚
     â”‚      |                                                         â”‚
     â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€ L2 â”€â”€â”€â”                                            â”‚
     â”‚  â”‚ [Gateway]  v6: fd00:1::1 / v4: 192.0.2.2                    â”‚
     â”‚  â”‚   - DNS64 (e.g., Unbound)                                   â”‚
     â”‚  â”‚   - NAT64 (e.g., Jool/Tayga) â†’ 64:ff9b::/96                 â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  NAT44/MASQUERADE â†’ Internet (IPv4-only)
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

  <h3>RA/DHCPv6ï¼ˆdnsmasqä¾‹ï¼‰</h3>
  <pre><code># /etc/dnsmasq.d/ipv6.conf
interface=eth0
enable-ra
# ULAã‚’é…å¸ƒï¼ˆSLAACï¼‰
dhcp-range=::,constructor:eth0,ra-only,64,12h
# DNSã¯ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®ULAã«
dhcp-option=option6:dns-server,[fd00:1::1]</code></pre>

  <h3>DNS64ï¼ˆUnboundä¾‹ï¼‰</h3>
  <pre><code># /etc/unbound/unbound.conf.d/dns64.conf
server:
  interface: fd00:1::1
  do-ip6: yes
  module-config: "dns64 validator iterator"

dns64:
  prefix: 64:ff9b::/96</code></pre>

  <h3>NAT64ï¼ˆJoolä¾‹ï¼‰</h3>
  <pre><code># ä¾‹ï¼šãƒ—ãƒ¼ãƒ«ã¯ Well-Known Prefix ã‚’ä½¿ç”¨
jool instance add --netfilter --pool6 64:ff9b::/96
jool -t nat64 --enable

# outsideå´ã¯å¾“æ¥ã®IPv4 NAT
iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</code></pre>

  <div class="merit"><strong>ãƒ¡ãƒªãƒƒãƒˆ:</strong> ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ v6-only ã§OKï¼ˆv4ä¸è¦ï¼‰ï¼outsideã¯IPv4-onlyã§OKï¼å¤§åŠã®ã‚¢ãƒ—ãƒªãŒé€éçš„ã«å‹•ä½œ</div>
  <div class="demerit"><strong>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:</strong> ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã§DNS64/NAT64ã®ç”¨æ„ãŒå¿…è¦</div>

  <h2>ğŸ§° æ–¹æ³•2ï¼šã‚¢ãƒ—ãƒªå±¤ãƒ—ãƒ­ã‚­ã‚·ï¼ˆãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«æ¥ç¶šï¼‰</h2>
  <p>IPãƒ¬ã‚¤ãƒ¤ã®è»¢é€ã¯è«¦ã‚ã€<strong>åŒä¸€ãƒªãƒ³ã‚¯ä¸Š</strong>ã®ãƒ—ãƒ­ã‚­ã‚·ã¸ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã§æ¥ç¶šã—ã¾ã™ã€‚</p>

  <h3>Squidï¼ˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤å´ï¼‰</h3>
  <pre><code># squid.confï¼ˆãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒã‚¤ãƒ³ãƒ‰ï¼‰
http_port [fe80::1%eth0]:3128
acl localv6 localnet
http_access allow localv6</code></pre>

  <h3>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šä¾‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰</h3>
  <pre><code># URLæ¬„ï¼OSè¨­å®šã§ãƒ—ãƒ­ã‚­ã‚·æŒ‡å®š
http://[fe80::1%eth0]:3128
# Windows ä¾‹: %Ethernet / macOS: %en0 / Linux: %eth0 ãªã©</code></pre>

  <h3>SOCKS5 ä¾‹ï¼ˆdantedï¼‰</h3>
  <pre><code># /etc/danted.confï¼ˆè¦ä»¶ã«åˆã‚ã›ã¦èª¿æ•´ï¼‰
logoutput: /var/log/danted.log
internal: [fe80::1%eth0] port = 1080
external: eth1  # IPv4 ã‚¢ãƒƒãƒ—ãƒªãƒ³ã‚¯å´
method: username none
clientmethod: none
user.notprivileged: nobody</code></pre>

  <div class="merit"><strong>ãƒ¡ãƒªãƒƒãƒˆ:</strong> ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯LLAã®ã¿ã®ã¾ã¾ï¼æ§‹ç¯‰ãŒæ¯”è¼ƒçš„å®¹æ˜“</div>
  <div class="demerit"><strong>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:</strong> ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œã‚¢ãƒ—ãƒªã«é™å®šï¼åå‰è§£æ±ºã®æ‰€åœ¨ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ or ãƒ—ãƒ­ã‚­ã‚·ï¼‰ã‚’è¦è¨­è¨ˆ</div>

  <h2>ğŸ” ã‚ˆãã‚ã‚‹è³ªå•</h2>
  <table>
    <tr><th>è³ªå•</th><th>å›ç­”</th></tr>
    <tr>
      <td>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚’æŒ‡å®šã—ã¦ã‚‚è‰¯ã„ï¼Ÿ</td>
      <td>ã¯ã„ã€next-hop ã¨ã—ã¦ã®æŒ‡å®šã¯å¯èƒ½ã§ã™ã€‚ãŸã ã—<strong>é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ãŒLLAã®ã¾ã¾ã§ã¯ãƒ«ãƒ¼ã‚¿ã¯è»¢é€ã—ã¾ã›ã‚“</strong>ã€‚ULAã‚„GUAã‚’æŒãŸã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</td>
    </tr>
    <tr>
      <td>outsideãŒIPv4-onlyã§ã‚‚å¤§ä¸ˆå¤«ï¼Ÿ</td>
      <td>æ–¹æ³•1ï¼ˆDNS64/NAT64ï¼‰ãªã‚‰å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŒ v6â†’v4 å¤‰æ›ã—ã¾ã™ã€‚</td>
    </tr>
    <tr>
      <td>åå‰è§£æ±ºã¯ï¼Ÿ</td>
      <td>æ–¹æ³•1ã§ã¯DNS64ãŒAAAAã‚’åˆæˆã€æ–¹æ³•2ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ãƒ—ãƒ­ã‚­ã‚·å´ã§è¡Œã„ã¾ã™ã€‚</td>
    </tr>
  </table>

  <h2>ğŸ“˜ ã¾ã¨ã‚</h2>
  <div class="summary">
    <strong>ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿</strong>ã§ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸å¯ã€‚<br>
    ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å‹•ã‹ã™ãªã‚‰ <strong>ULA + DNS64/NAT64</strong>ã€‚<br>
    æœ€å°æ§‹æˆã§ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ç­‰ãªã‚‰ <strong>ã‚¢ãƒ—ãƒªå±¤ãƒ—ãƒ­ã‚­ã‚·</strong> ãŒå®Ÿç”¨çš„ã§ã™ã€‚
  </div>

  <div class="note">ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€æ—¢å­˜ã®ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½“è£ã«åˆã‚ã›ãŸé«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼†ãƒ—ãƒ¬ãƒ¼ãƒ³èƒŒæ™¯ã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚</div>
</main>
</body>
</html>
