<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Firebase Hosting é‹ç”¨ã‚¬ã‚¤ãƒ‰ï¼šPR â†’ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â†’ æœ¬ç•ªï¼ˆcloneæ˜‡æ ¼å¯¾å¿œï¼‰</title>
  <style>
    body { font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, Arial, sans-serif; background:#ffffff; color:#111; line-height:1.75; margin:0; }
    main { max-width: 960px; margin: 24px auto; padding: 24px; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); background:#fff; }
    h1 { color:#0b4a6f; margin:0 0 12px; }
    h2 { color:#0b4a6f; margin:24px 0 8px; }
    h3 { color:#0b4a6f; margin:16px 0 6px; }
    p { margin: 0 0 12px; }
    ul { margin: 0 0 12px 20px; }
    pre { background:#ffffff; color:#111; border:1px solid #cbd5e1; border-radius:8px; padding:12px; overflow:auto; }
    pre code { background:none; font-family: Consolas, Menlo, Monaco, "Courier New", monospace; font-size:15px; line-height:1.35; white-space:pre; display:block; }
    table { width:100%; border-collapse:collapse; margin: 12px 0; font-size: 14px; }
    th, td { border:1px solid #e5e7eb; padding:8px; text-align:left; }
    th { background:#f1f5f9; }
    .note { background:#e0f2fe; border-left:6px solid #0ea5e9; padding:12px; border-radius:6px; margin:12px 0; }
    .merit { background:#dcfce7; border-left:6px solid #22c55e; padding:12px; border-radius:6px; margin:12px 0; }
    .demerit { background:#fee2e2; border-left:6px solid #ef4444; padding:12px; border-radius:6px; margin:12px 0; }
    .summary { background:#f8fafc; border: 2px solid #e2e8f0; padding: 12px; border-radius: 8px; }
    .kbd { display:inline-block; padding:1px 6px; border:1px solid #cbd5e1; border-bottom-width:2px; border-radius:4px; background:#fff; font-family: Consolas, Menlo, Monaco, "Courier New", monospace; font-size: 90%; }
  </style>
</head>
<body>
<main>
  <h1>ğŸš€ Firebase Hosting é‹ç”¨ã‚¬ã‚¤ãƒ‰ï¼ˆPR â†’ Staging â†’ æœ¬ç•ªï¼‰</h1>
  <p><strong>æ¦‚è¦:</strong> GitHub ã§HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å…±åŒé–‹ç™ºã—ã€<span class="kbd">PRä½œæˆ â†’ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ ç¢ºèª â†’ ãƒãƒ¼ã‚¸ â†’ æœ¬ç•ª</span> ã®æµã‚Œã§å®‰å…¨ã«åæ˜ ã™ã‚‹ãŸã‚ã®æ‰‹é †ã‚’ã€<strong>cloneæ˜‡æ ¼</strong>ã«ã‚‚å¯¾å¿œã—ãŸå½¢ã§ã¾ã¨ã‚ã¾ã™ã€‚</p>

  <h2>ğŸ§­ å…¨ä½“ãƒ•ãƒ­ãƒ¼</h2>
  <pre><code>é–‹ç™ºè€…ãƒ­ãƒ¼ã‚«ãƒ«                GitHub / Actions                 Firebase Hosting
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1) ä¿®æ­£/å‹•ä½œç¢ºèª           4) PRä½œæˆ                          6) æœ¬ç•ªåæ˜ 
2) stagingã¸æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ 5) ActionsãŒstagingã¸è‡ªå‹•åæ˜   â†’   (a) é€šå¸¸: mainãƒãƒ¼ã‚¸ã§prodã¸ãƒ‡ãƒ—ãƒ­ã‚¤
3) ãƒ–ãƒ©ãƒ³ãƒä½œæˆ/commit/push                                     (b) cloneæ˜‡æ ¼: staging:live â†’ prod:live</code></pre>

  <h2>ğŸ›  äº‹å‰æº–å‚™ï¼ˆç¢ºèªï¼‰</h2>
  <ul>
    <li><code>.firebaserc</code> ã§ <code>staging</code> / <code>production</code> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒè¨­å®šæ¸ˆã¿</li>
    <li><code>firebase.json</code> ã® <code>hosting</code> ã« <code>target</code> ãŒå®šç¾©æ¸ˆã¿ï¼ˆpublic/CSPç­‰ã®è¨­å®šå…±é€šï¼‰</li>
    <li>GitHub Actionsï¼ˆä¾‹ï¼š<code>firebase-hosting-pull-request.yml</code> / <code>firebase-hosting-merge.yml</code>ï¼‰ãŒé…ç½®æ¸ˆã¿</li>
    <li>ï¼ˆä»»æ„ï¼‰<code>promote-prod.yml</code> ã‚’ç”¨æ„ã—ã¦ <strong>cloneæ˜‡æ ¼</strong> ã‚’ãƒœã‚¿ãƒ³1ã¤ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹</li>
  </ul>

  <h2>â‘  ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèªï¼‰</h2>
  <pre><code>firebase deploy --only hosting:staging</code></pre>
  <p>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°URLã§è¡¨ç¤ºå´©ã‚Œãƒ»ãƒªãƒ³ã‚¯åˆ‡ã‚Œãƒ»CSPé•åãªã©ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>

  <h2>â‘¡ ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ â†’ å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ/ãƒ—ãƒƒã‚·ãƒ¥</h2>
  <pre><code>git checkout -b feature/staging-deploy-YYYYMMDD
# å¤‰æ›´ã‚’åŠ ãˆã‚‹

git add .
git commit -m "Fix: top page content & staging check"
git push -u origin feature/staging-deploy-YYYYMMDD</code></pre>

  <h2>â‘¢ Pull Requestï¼ˆPRï¼‰ã‚’ä½œæˆ</h2>
  <ol>
    <li>GitHubã®ãƒªãƒã‚¸ãƒˆãƒªç”»é¢ã§ <strong>Compare &amp; pull request</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
    <li>ã‚¿ã‚¤ãƒˆãƒ«ï¼èª¬æ˜ï¼ˆå¤‰æ›´ç‚¹ãƒ»ç¢ºèªè¦³ç‚¹ãƒ»ã‚¹ã‚¯ã‚·ãƒ§ï¼‰ã‚’è¨˜è¼‰ã—ã€<strong>Create pull request</strong></li>
    <li>Actions ãŒè‡ªå‹•ã§ <strong>staging</strong> ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆPRã‚³ãƒ¡ãƒ³ãƒˆã«URLãŒä»˜ãå ´åˆã‚ã‚Šï¼‰</li>
  </ol>

  <div><img src="images/g2-1.png" alt="" width="477.5" height="157"></div>

  <h2>â‘£ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚’æœ€çµ‚ç¢ºèª</h2>
  <ul>
    <li>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°URLã¯ https://stg.docs.cxj-collab.com ã“ã¡ã‚‰</li>
    <li>ã“ã“ã§æƒ³å®šã©ãŠã‚Šè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã€ãƒªãƒ³ã‚¯ãƒ»ç”»åƒãƒ»åŸ‹ã‚è¾¼ã¿ï¼ˆSharePointç­‰ï¼‰ã‚’å†ç¢ºèª</li>
    <li>ãƒãƒ¼ãƒ é‹ç”¨ãªã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ï¼ˆReviewer æœªæŒ‡å®šã§ã‚‚PRã¯ä½œæˆå¯èƒ½ï¼‰</li>
  </ul>

  <h2>â‘¤ æœ¬ç•ªåæ˜ ï¼ˆ2é€šã‚Šï¼‰</h2>
  <h3>A. é€šå¸¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmain ã¸ãƒãƒ¼ã‚¸ï¼‰</h3>
  <ol>
    <li>å…¨ãƒã‚§ãƒƒã‚¯ãŒ <strong>passed</strong> ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
    <li><strong>Merge pull request</strong> â†’ <strong>Confirm merge</strong></li>
    <li>main ã¸ã® push ã‚’ãƒˆãƒªã‚¬ã« Actions ãŒ <strong>production</strong> ã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</li>
  </ol>

  <h3>B. cloneæ˜‡æ ¼ï¼ˆstaging ã¨å®Œå…¨åŒä¸€ãƒã‚¤ãƒŠãƒªã‚’ prod ã«æ˜‡æ ¼ï¼‰</h3>
  <p>Actions ã® <code>Promote staging â†’ production (clone)</code> ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ <strong>Run workflow</strong>ã€‚æ—¢å®šã¯ <code>&lt;STAGING_SITE_ID&gt;:live</code> â†’ <code>&lt;PRODUCTION_SITE_ID&gt;:live</code> ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚</p>
  <pre><code># å‚è€ƒï¼šæ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆåŒä¸€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ï¼‰
firebase hosting:clone &lt;STAGING_SITE_ID&gt;:live &lt;PRODUCTION_SITE_ID&gt;:live --project &lt;PROJECT_ID&gt;</code></pre>
  <div class="merit"><strong>ãƒ¡ãƒªãƒƒãƒˆ:</strong> å†ãƒ“ãƒ«ãƒ‰ä¸è¦ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã§ç¢ºèªã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãã®ã¾ã¾æœ¬ç•ªã¸ã€‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚å®¹æ˜“ã€‚</div>
  <div class="demerit"><strong>æ³¨æ„:</strong> site ID ã¨ target åã¯åˆ¥æ¦‚å¿µã€‚<code>hosting:clone</code> ã¯ site ID æŒ‡å®šã§ã™ã€‚<code>.firebaserc</code> ã® targets ã¨å–ã‚Šé•ãˆãªã„ã‚ˆã†ã«ã€‚</div>

  <h2>ğŸ” ã‚ˆãã‚ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã¨å¯¾å‡¦</h2>
  <table>
    <tr><th>ç¾è±¡</th><th>åŸå› </th><th>å¯¾å‡¦</th></tr>
    <tr>
      <td>ã€ŒAt least 1 approving review is requiredã€</td>
      <td>main ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…é ˆã®ä¿è­·ãƒ«ãƒ¼ãƒ« / Rulesets</td>
      <td>Reviewer ã« Approve ä¾é ¼ / ç®¡ç†è€…ãƒã‚¤ãƒ‘ã‚¹è¨±å¯ / Environments å´ã¸æ‰¿èªã‚²ãƒ¼ãƒˆã‚’ç§»ã™</td>
    </tr>
    <tr>
      <td>ã€ŒCannot change this locked branchã€</td>
      <td>Branch protection + Rulesets ã«ã‚ˆã‚‹ãƒ­ãƒƒã‚¯</td>
      <td>Rulesets ã‚’ç¢ºèªã—ã€ãƒã‚¤ãƒ‘ã‚¹åˆã¯ä¸€æ™‚ç·©å’Œã€‚çµ„ç¹”ç®¡ç†è€…ã¸ä¾é ¼ãŒå¿…è¦ãªå ´åˆã‚ã‚Š</td>
    </tr>
    <tr>
      <td>staging ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œãªã„</td>
      <td>PRç”¨ActionsãŒç„¡åŠ¹ / permissionsä¸è¶³ / targetæœªè¨­å®š</td>
      <td>Actionsæœ‰åŠ¹åŒ–ãƒ»Secretsè¨­å®šãƒ»<code>.firebaserc</code> ã® targets ã‚’å†ç¢ºèª</td>
    </tr>
  </table>

  <h2>ğŸ“Œ ä»˜éŒ²ï¼šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>
  <ul>
    <li>PRã‚¿ã‚¤ãƒˆãƒ«ã¯ã€Œå†…å®¹ï¼‹æ—¥ä»˜ã€ã§çµ±ä¸€ï¼ˆä¾‹ï¼š<code>Update: jumbo-frame article (2025-10-23)</code>ï¼‰</li>
    <li>Merge å¾Œã¯ä¸è¦ã«ãªã£ãŸ feature ãƒ–ãƒ©ãƒ³ãƒã‚’ <strong>Delete branch</strong></li>
    <li>SharePoint åŸ‹ã‚è¾¼ã¿æ™‚ã¯ CSP ã® <code>frame-ancestors</code> ã‚’ç¶­æŒ</li>
  </ul>

  <div class="summary">
    <strong>çµè«–:</strong> <em>PR â†’ staging è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ ç›®è¦–OK â†’ ãƒãƒ¼ã‚¸ï¼ˆã¾ãŸã¯ cloneæ˜‡æ ¼ï¼‰â†’ æœ¬ç•ª</em> ã®å‹ã«æƒãˆã‚‹ã¨ã€å†ç¾æ€§ãŒé«˜ãå®‰å…¨ã«é‹ç”¨ã§ãã¾ã™ã€‚cloneæ˜‡æ ¼ã‚’ç”¨æ„ã—ã¦ãŠã‘ã°ã€ã€Œstaging ã¨å®Œå…¨åŒä¸€ã§å‡ºã™ã€è¦ä»¶ã«ã‚‚å³å¯¾å¿œã§ãã¾ã™ã€‚
  </div>
</main>
</body>
</html>